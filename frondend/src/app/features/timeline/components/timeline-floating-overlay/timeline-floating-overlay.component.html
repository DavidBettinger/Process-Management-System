<div
  class="fixed inset-0 z-50 bg-transparent"
  data-testid="timeline-floating-overlay-backdrop"
  (click)="onBackdropClick()"
>
  <section
    class="absolute rounded-2xl border border-slate-200 bg-white p-4 shadow-2xl"
    [ngStyle]="panelStyles()"
    [class.overlay-left]="placement().horizontal === 'left'"
    [class.overlay-right]="placement().horizontal === 'right'"
    [class.overlay-up]="placement().vertical === 'up'"
    [class.overlay-down]="placement().vertical === 'down'"
    data-testid="timeline-floating-overlay"
    (click)="onPanelClick($event)"
  >
    @if (details(); as detailsValue) {
      <header
        class="mb-3 flex items-start justify-between gap-3 cursor-move"
        data-testid="timeline-floating-overlay-drag-handle"
        (pointerdown)="onDragHandlePointerDown($event)"
      >
        <div class="space-y-1">
          <p class="text-[11px] font-semibold uppercase tracking-wide text-slate-500">
            {{ nodeTypeLabel(detailsValue) }}
          </p>
          <h3 class="text-sm font-semibold text-slate-900">Details</h3>
        </div>
        <button
          type="button"
          class="rounded-md border border-slate-200 px-2 py-1 text-xs font-medium text-slate-600 hover:bg-slate-100"
          data-testid="timeline-floating-overlay-close"
          (pointerdown)="$event.stopPropagation()"
          (click)="close()"
        >
          X
        </button>
      </header>

      @if (detailsValue.type === 'meeting') {
        <div class="space-y-2" data-testid="timeline-floating-overlay-meeting">
          <p class="text-sm text-slate-800"><span class="font-medium">Titel:</span> {{ detailsValue.title }}</p>
          <p class="text-sm text-slate-800"><span class="font-medium">Datum:</span> {{ detailsValue.dateLabel }}</p>
          <p class="text-sm text-slate-800"><span class="font-medium">Ort:</span> {{ detailsValue.locationLabel }}</p>
          <div class="space-y-1">
            <p class="text-sm font-medium text-slate-800">Beteiligte</p>
            @if (detailsValue.participantLabels.length > 0) {
              <ul class="list-disc space-y-1 pl-5 text-sm text-slate-800">
                @for (participant of detailsValue.participantLabels; track participant) {
                  <li>{{ participant }}</li>
                }
              </ul>
            } @else {
              <p class="text-sm text-slate-600">Keine Beteiligten hinterlegt</p>
            }
          </div>
        </div>
      }

      @if (detailsValue.type === 'task') {
        <div class="space-y-2" data-testid="timeline-floating-overlay-task">
          <p class="text-sm text-slate-800"><span class="font-medium">Titel:</span> {{ detailsValue.title }}</p>
          <p class="text-sm text-slate-800"><span class="font-medium">Status:</span> {{ detailsValue.statusLabel }}</p>
          <p class="text-sm text-slate-800"><span class="font-medium">Prioritaet:</span> {{ detailsValue.priorityLabel }}</p>
          <p class="text-sm text-slate-800"><span class="font-medium">Zustaendig:</span> {{ detailsValue.assigneeLabel }}</p>
        </div>
      }

      @if (detailsValue.type === 'stakeholder') {
        <div class="space-y-2" data-testid="timeline-floating-overlay-stakeholder">
          <p class="text-sm text-slate-800"><span class="font-medium">Name:</span> {{ detailsValue.fullName }}</p>
          <p class="text-sm text-slate-800"><span class="font-medium">Rolle:</span> {{ detailsValue.roleLabel }}</p>
          <p class="text-sm text-slate-800">
            <span class="font-medium">Zugeordneter Termin:</span> {{ detailsValue.relatedMeetingLabel }}
          </p>
        </div>
      }
    }
  </section>
</div>
