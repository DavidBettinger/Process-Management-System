<section class="attachments">
  <button type="button" class="attachments-toggle" (click)="toggleOpen()">
    {{ isOpen() ? 'Anhaenge ausblenden' : 'Anhaenge anzeigen' }}
  </button>

  @if (isOpen()) {
    <div class="attachments-body">
      <form class="upload-form" [formGroup]="form" (ngSubmit)="submitUpload()">
        <div class="upload-field">
          <label class="file-label" [attr.for]="'file-' + taskIdValue()">Datei</label>
          <input
            #fileInput
            class="file-input"
            type="file"
            [id]="'file-' + taskIdValue()"
            (change)="handleFileChange($event)"
          />
          @if (isInvalid('file')) {
            <span class="error">{{ requiredMessage('Datei') }}</span>
          }
        </div>
        <button type="submit" class="primary" [disabled]="isUploading()">
          {{ isUploading() ? 'Lade hoch...' : 'Hochladen' }}
        </button>
      </form>

      @if (status() === 'loading') {
        <p class="status">Laedt...</p>
      }
      @if (error()) {
        <p class="error">{{ error()?.message ?? 'Anhaenge konnten nicht geladen werden.' }}</p>
      }
      @if (isEmpty()) {
        <p class="empty">Keine Anhaenge vorhanden.</p>
      }

      @if (attachments().length > 0) {
        <ul class="attachments-list">
          @for (attachment of attachments(); track attachment.id) {
            <li class="attachment-item">
              <div>
                <p class="attachment-name">{{ attachment.fileName }}</p>
                <p class="attachment-meta">
                  {{ formatBytes(attachment.sizeBytes) }} | {{ attachment.uploadedAt | date: 'short' }}
                </p>
              </div>
              <div class="attachment-actions">
                <button
                  type="button"
                  class="ghost"
                  (click)="downloadAttachment(attachment)"
                  [disabled]="isBusy(attachment.id)"
                >
                  Herunterladen
                </button>
                <button
                  type="button"
                  class="danger"
                  (click)="confirmDelete(attachment)"
                  [disabled]="isBusy(attachment.id)"
                >
                  Loeschen
                </button>
              </div>
            </li>
          }
        </ul>
      }
    </div>
  }
</section>
