<section class="page">
  <header class="page-header">
    <div>
      <p class="eyebrow">Beteiligte</p>
      <h1>{{ headerTitle() }}</h1>
      <p class="subtitle">Aufgaben und Rollen in Prozessen auf einen Blick.</p>
    </div>
    @if (profileStatus() === 'success') {
      <div class="profile-card">
        <p class="profile-label">Rolle</p>
        <p class="profile-value">{{ roleLabel(profile()?.role) }}</p>
      </div>
    }
  </header>

  <div class="panel">
    <div class="panel-header">
      <div>
        <h2>Zugeordnete Aufgaben</h2>
        <p>Diese Aufgaben sind der Person in Prozessen zugewiesen.</p>
      </div>
      @if (tasksStatus() === 'success') {
        <div class="panel-meta">{{ totalItems() }} Aufgaben</div>
      }
    </div>

    @if (profileStatus() === 'error') {
      <div class="state">
        <p class="state-title">Profil konnte nicht geladen werden</p>
        <p class="state-text">{{ profileError()?.message ?? 'Unbekannter Fehler' }}</p>
      </div>
    }

    @if (tasksStatus() === 'loading') {
      <div class="state">
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
      </div>
    }

    @if (tasksStatus() === 'error') {
      <div class="state">
        <p class="state-title">Aufgaben konnten nicht geladen werden</p>
        <p class="state-text">{{ tasksError()?.message ?? 'Unbekannter Fehler' }}</p>
        <button class="ghost-button" type="button" (click)="store.loadTasks()">Erneut versuchen</button>
      </div>
    }

    @if (tasksStatus() === 'success' && tasks().length === 0) {
      <div class="state">
        <p class="state-title">Keine Aufgaben zugeordnet</p>
        <p class="state-text">Aktuell sind dieser Person keine Aufgaben in Prozessen zugewiesen.</p>
      </div>
    }

    @if (tasksStatus() === 'success' && tasks().length > 0) {
      <div class="tasks-table">
        <div class="tasks-row header">
          <span>Titel</span>
          <span>Status</span>
          <span>Faellig</span>
          <span>Prozess</span>
        </div>
        @for (task of tasks(); track task.id) {
          <div class="tasks-row">
            <span class="task-title">{{ task.title }}</span>
            <span>{{ stateLabel(task.state) }}</span>
            <span>{{ dueDateLabel(task.dueDate) }}</span>
            <span>{{ task.caseId | processLabel }}</span>
          </div>
        }
      </div>
    }

    @if (tasksStatus() === 'success' && tasks().length > 0) {
      <div class="pagination">
        <button
          class="ghost-button pagination-button"
          type="button"
          [disabled]="!hasPrev()"
          (click)="prevPage()"
        >
          Zurueck
        </button>
        <span class="page-indicator">Seite {{ page() + 1 }} von {{ totalPages() }}</span>
        <button
          class="ghost-button pagination-button"
          type="button"
          [disabled]="!hasNext()"
          (click)="nextPage()"
        >
          Weiter
        </button>
        <label class="page-size">
          <span>Pro Seite</span>
          <select [value]="size()" (change)="handlePageSizeChange($event)">
            @for (option of pageSizes; track option) {
              <option [value]="option">{{ option }}</option>
            }
          </select>
        </label>
      </div>
    }
  </div>
</section>
