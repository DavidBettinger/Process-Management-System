<div class="actions">
  @if (isResolved()) {
    <p class="resolved">Aufgabe ist abgeschlossen. Aktionen sind deaktiviert.</p>
  }

  <div class="action-row">
    <div class="action-block">
      <h4>Zuweisen</h4>
      <form [formGroup]="assignForm" (ngSubmit)="submitAssign()">
        <app-stakeholder-select
          [stakeholders]="stakeholders"
          [selectedId]="assignForm.controls.assigneeId.value"
          [disabled]="!stakeholdersReady"
          [required]="true"
          (selectedIdChange)="assignForm.controls.assigneeId.setValue($event ?? '')"
        />
        <button
          type="submit"
          class="ghost-button"
          [disabled]="!canAssign() || busy || !stakeholdersReady || assignForm.invalid"
        >
          Zuweisen
        </button>
      </form>
    </div>

    <div class="action-block">
      <h4>Starten</h4>
      <button type="button" class="ghost-button" [disabled]="!canStart() || busy" (click)="submitStart()">
        Starten
      </button>
    </div>

    <div class="action-block">
      <h4>Blockieren</h4>
      <form [formGroup]="blockForm" (ngSubmit)="submitBlock()">
        <input type="text" formControlName="reason" placeholder="Grund" />
        <button type="submit" class="ghost-button" [disabled]="!canBlock() || busy || blockForm.invalid">
          Blockieren
        </button>
      </form>
    </div>
  </div>

  <div class="action-row">
    <div class="action-block">
      <h4>Entsperren</h4>
      <button type="button" class="ghost-button" [disabled]="!canUnblock() || busy" (click)="submitUnblock()">
        Entsperren
      </button>
    </div>

    <div class="action-block">
      <h4>Abgeben</h4>
      <form [formGroup]="declineForm" (ngSubmit)="submitDecline()">
        <input type="text" formControlName="reason" placeholder="Grund" />
        <app-stakeholder-select
          [stakeholders]="stakeholders"
          [selectedId]="declineForm.controls.suggestedAssigneeId.value"
          [disabled]="!stakeholdersReady"
          [required]="false"
          [placeholder]="'Vorschlag (optional)'"
          (selectedIdChange)="declineForm.controls.suggestedAssigneeId.setValue($event ?? '')"
        />
        <button type="submit" class="ghost-button" [disabled]="!canDecline() || busy || declineForm.invalid">
          Abgeben
        </button>
      </form>
    </div>

    <div class="action-block">
      <h4>Abschliessen</h4>
      <form [formGroup]="resolveForm" (ngSubmit)="submitResolve()">
        <select formControlName="kind">
          @for (option of resolveKinds; track option.value) {
            <option [value]="option.value">{{ option.label }}</option>
          }
        </select>
        <input type="text" formControlName="reason" placeholder="Begruendung" />
        <button type="submit" class="ghost-button" [disabled]="!canResolve() || busy || resolveForm.invalid">
          Abschliessen
        </button>
      </form>
    </div>
  </div>
</div>
