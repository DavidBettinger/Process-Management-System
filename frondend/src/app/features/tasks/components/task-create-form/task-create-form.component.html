<section class="space-y-4">
  @if (showHeader) {
    <header class="space-y-1">
      <h3 class="text-lg font-semibold text-slate-900">{{ headerTitle }}</h3>
      <p class="text-sm text-slate-600">{{ headerSubtitle }}</p>
    </header>
  }

  @if (useFormTag) {
    <form class="space-y-4" [formGroup]="form" (ngSubmit)="submit()">
      <app-tw-field
        label="Titel"
        forId="task-title"
        [required]="true"
        [error]="isInvalid('title') ? requiredMessage('Titel') : null"
      >
        <input
          id="task-title"
          type="text"
          formControlName="title"
          placeholder="z.B. Konzeptentwurf vorbereiten"
          class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 placeholder:text-slate-400 focus:border-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-200"
        />
      </app-tw-field>

      @if (showPriority) {
        <app-tw-field
          label="Prioritaet"
          forId="task-priority"
          [required]="true"
          [error]="isInvalid('priority') ? requiredMessage('Prioritaet') : null"
        >
          <select
            id="task-priority"
            formControlName="priority"
            class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 focus:border-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-200"
          >
            @for (option of priorityOptions; track option.value) {
              <option [value]="option.value">{{ option.label }}</option>
            }
          </select>
        </app-tw-field>
      }

      @if (showDescription) {
        <app-tw-field label="Beschreibung (optional)" forId="task-description">
          <textarea
            id="task-description"
            formControlName="description"
            rows="3"
            placeholder="Weitere Details oder Hinweise"
            class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 placeholder:text-slate-400 focus:border-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-200"
          ></textarea>
        </app-tw-field>
      }

      @if (showDueDate) {
        <app-tw-field label="Faellig bis (optional)" forId="task-due-date">
          <input
            id="task-due-date"
            type="date"
            formControlName="dueDate"
            class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 focus:border-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-200"
          />
        </app-tw-field>
      }

      <button appTwButton="primary" type="submit" [disabled]="loading">
        {{ submitLabel }}
      </button>
    </form>
  } @else {
    <div class="space-y-4" [formGroup]="form">
      <app-tw-field
        label="Titel"
        forId="task-title-inline"
        [required]="true"
        [error]="isInvalid('title') ? requiredMessage('Titel') : null"
      >
        <input
          id="task-title-inline"
          type="text"
          formControlName="title"
          placeholder="z.B. Konzeptentwurf vorbereiten"
          class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 placeholder:text-slate-400 focus:border-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-200"
        />
      </app-tw-field>

      @if (showPriority) {
        <app-tw-field
          label="Prioritaet"
          forId="task-priority-inline"
          [required]="true"
          [error]="isInvalid('priority') ? requiredMessage('Prioritaet') : null"
        >
          <select
            id="task-priority-inline"
            formControlName="priority"
            class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 focus:border-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-200"
          >
            @for (option of priorityOptions; track option.value) {
              <option [value]="option.value">{{ option.label }}</option>
            }
          </select>
        </app-tw-field>
      }

      @if (showDescription) {
        <app-tw-field label="Beschreibung (optional)" forId="task-description-inline">
          <textarea
            id="task-description-inline"
            formControlName="description"
            rows="3"
            placeholder="Weitere Details oder Hinweise"
            class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 placeholder:text-slate-400 focus:border-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-200"
          ></textarea>
        </app-tw-field>
      }

      @if (showDueDate) {
        <app-tw-field label="Faellig bis (optional)" forId="task-due-date-inline">
          <input
            id="task-due-date-inline"
            type="date"
            formControlName="dueDate"
            class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 focus:border-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-200"
          />
        </app-tw-field>
      }

      <button appTwButton="primary" type="button" [disabled]="loading" (click)="submit()">
        {{ submitLabel }}
      </button>
    </div>
  }
</section>
